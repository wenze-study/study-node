# 第三章 资源管理

本章节主要介绍 yaml 语法和 kubernetes 的资源管理方式

## 一、资源管理介绍

在 kubernetes 中，所有的内容都抽象为资源，用户需要通过操作资源来管理 kubernetes。

> ​	kubernetes 的本质上就是一个集群系统，用户可以在集群中部署各种服务，所谓的部署服务，其实就是在 kubernetes 集群中运行一个个的容器，并将指定的程序跑在容器中。
>
> ​	kubernetes 的最小管理单元是 Pod 而不是容器，所以只能将容器放在 `Pod` 中，而 kubernetes 一般也不会直接管理 Pod，而是通过 `Pod控制器` 来管理 Pod 的。
>
> ​	Pod 可以提供服务之后，就要考虑如何访问 Pod 中服务，kubernetes 提供了 `Service` 资源实现这个功能。
>
> ​	当然，如果 Pod 中程序的数据需要持久化，kubernetes 还提供了各种 `存储` 系统。

![K8S-Pod控制器](https://study-node-md.oss-cn-beijing.aliyuncs.com/2023%2F09%2F14%2F1694684273-949d9168003e56952c47ee1616adcec9-image-20230914173752932.png)

> 学习 kubernetes 的核心，就是学习如何对集群上的 `Pod`、`Pod控制器`、`Service`、`存储`等各种资源进行操作

## 二、YAML 语法介绍

​	YAML 是一个类似 XML、JSON 的标记性语言。它强调以数据为中心，并不是以标记语言为重点。因而 YAML 本身的定义比较简单，号称“一种人性化的数据格式语言”。

```xml
<persoon>
  <age>15</age>
  <name>wenze</name>
</persoon>
```

```yaml
person:
	age: 15
	name: wenze
```

YAML 的语法比较简单，主要有下面几个：

- 大小写敏感
- 使用缩进表示层级关系
- 缩进不允许使用 tab，只允许空格（低版本限制）
- 缩进的空格数不重要，只要相同层级的元素左对齐即可
- '#' 表示注释

YAML 支持以下几种数据类型：

- 纯量：单个的、不可再分的值
- 对象：键值对的集合，又称为映射（mapping）、哈希（hash）、字典（dictionary）
- 数组：一组按次序排列的值，又称为序列（sequence）、列表（list）

```yaml
# 纯量，就是指的一个简单的值，字符串、布尔值、整数、浮点数、Null、时间、日期

# 布尔类型
c1: true（或者 True）

# 整型
c2: 234

# 浮点型
c3: 3.14

# null 类型
c4: ~

# 日期类型
c5: 2018-02-17 # 日期必须使用 ISO 8601 格式，即 yyyy-MM-dd

# 时间类型
# 时间使用 ISO 8601 格式，时间和日期之间使用 T 连接，最后使用 + 代表时区
c6: 2018-02-17T15:02:31+08:00

# 字符串类型
c7: person # 简单写法，直接写值，如果字符串中间有特殊字符，必须使用双引号或者单引号包裹
c8: line1
	  line2 # 字符串过多的情况可以拆成多行，每一行会被转化成一个空格
```

```yaml
# 对象
# 形式一（推荐）
person:
	age: 18
	name: wenze
	address: Beijing
	
# 形式二（了解）
person: {age: 15, address: Beijing, name: wenze}
```

```yaml
# 数组
# 形式一（推荐）
address:
	- 顺义
	- 昌平
	
# 形式二（了解）
address: [顺义, 昌平]
```

> 小提示：
>
> 1. 书写 yaml 切记 `:` 后面要加一个空格
>
> 2. 如果需要将多段 yaml 配置放在一个文件中，中间要使用 `---` 分隔
>
> 3. 下面是一个 yaml 转 json 的网站，可以通过它验证 yaml 是否书写正确
>
>     https://www.json2yaml.com/covert-yaml-to-json

## 三、资源管理方式

- 命令式对象管理：直接使用命令去操作 kubernetes 资源

    `kubectl run nginx-pod --image=nginx:1.17.1 --port=80`

- 命令式对象配置：通过命令配置和配置文件去操作 kubernetes 资源

    `kubectl create/patch -f nginx-pod.yaml`

- 声明式对象配置：通过 apply 命令和配置文件去操作 kubernetes 资源

    `kubectl apply -f nginx-pod.yaml`

| 类型           | 操作对象 | 适用环境 | 优点           | 缺点                             |
| -------------- | -------- | -------- | -------------- | -------------------------------- |
| 命令式对象管理 | 对象     | 测试     | 简单           | 只能操作活动对象，无法升级、跟踪 |
| 命令式对象配置 | 文件     | 开发     | 可以审计、跟踪 | 项目大时，配置文件多，操作麻烦   |
| 声明式对象配置 | 目录     | 开发     | 支持目录操作   | 意外情况下难以调试               |

### 1、命令式对象管理

















